{"version":3,"file":"wtf-plugin-api.js","sources":["../src/_fns.js","../src/getRedirects.js","../src/getIncoming.js","../src/getPageViews.js","../src/getTransclusions.js","../node_modules/slow/builds/slow.mjs","../src/getCategory.js","../src/getRandomCategory.js","../src/fetchList.js","../src/index.js"],"sourcesContent":["exports.normalize = function (title = '') {\n  title = title.replace(/ /g, '_')\n  title = title.trim()\n  title = encodeURIComponent(title)\n  return title\n}\n\nexports.defaults = {\n  lang: 'en',\n  path: '/w/api.php'\n}\n\nexports.toUrlParams = function (obj) {\n  let arr = Object.entries(obj).map(([key, value]) => {\n    return `${encodeURIComponent(key)}=${encodeURIComponent(value)}`\n  })\n  return arr.join('&')\n}\n","const { normalize, defaults, toUrlParams } = require('./_fns')\n\nconst params = {\n  action: 'query',\n  rdnamespace: 0,\n  prop: 'redirects',\n  rdlimit: 500,\n  format: 'json',\n  origin: '*',\n  redirects: true\n}\n\nconst makeUrl = function (title, options, cursor) {\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += toUrlParams(params)\n  url += `&titles=${normalize(title)}`\n  if (cursor) {\n    url += '&rdcontinue=' + cursor\n  }\n  return url\n}\n\nconst getRedirects = function (doc, http) {\n  let url = makeUrl(doc.title(), defaults)\n  return http(url).then((res) => {\n    let pages = Object.keys(res.query.pages || {})\n    if (pages.length === 0) {\n      return []\n    }\n    return res.query.pages[pages[0]].redirects || []\n  })\n}\nmodule.exports = getRedirects\n","const { normalize, defaults, toUrlParams } = require('./_fns')\n\nconst params = {\n  action: 'query',\n  lhnamespace: 0,\n  prop: 'linkshere',\n  lhshow: '!redirect',\n  lhlimit: 500,\n  format: 'json',\n  origin: '*',\n  redirects: true\n}\n\nconst makeUrl = function (title, options, cursor) {\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += toUrlParams(params)\n  url += `&titles=${normalize(title)}`\n  if (cursor) {\n    url += '&lhcontinue=' + cursor\n  }\n  return url\n}\n\nconst getIncoming = function (doc, http) {\n  let url = makeUrl(doc.title(), defaults)\n  return http(url).then((res) => {\n    let pages = Object.keys(res.query.pages || {})\n    if (pages.length === 0) {\n      return []\n    }\n    return res.query.pages[pages[0]].linkshere || []\n  })\n}\nmodule.exports = getIncoming\n","const { normalize, defaults, toUrlParams } = require('./_fns')\n\nconst params = {\n  action: 'query',\n  prop: 'pageviews',\n  format: 'json',\n  origin: '*',\n  redirects: true\n}\n\nconst makeUrl = function (title, options, cursor) {\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += toUrlParams(params)\n  url += `&titles=${normalize(title)}`\n  if (cursor) {\n    url += '&rdcontinue=' + cursor\n  }\n  return url\n}\n\nconst getPageViews = function (doc, http) {\n  let url = makeUrl(doc.title(), defaults)\n  return http(url).then((res) => {\n    let pages = Object.keys(res.query.pages || {})\n    if (pages.length === 0) {\n      return []\n    }\n    return res.query.pages[pages[0]].pageviews || []\n  })\n}\nmodule.exports = getPageViews\n","const { normalize, defaults, toUrlParams } = require('./_fns')\n\nconst params = {\n  action: 'query',\n  tinamespace: 0,\n  prop: 'transcludedin',\n  tilimit: 500,\n  format: 'json',\n  origin: '*',\n  redirects: true\n}\n\nconst makeUrl = function (title, options, cursor) {\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += toUrlParams(params)\n  url += `&titles=${normalize(title)}`\n  if (cursor) {\n    url += '&ticontinue=' + cursor\n  }\n  return url\n}\n\n// fetch all the pages that use a specific template\nconst getTransclusions = function (template, _options, http) {\n  let url = makeUrl(template, defaults)\n  return http(url).then((res) => {\n    let pages = Object.keys(res.query.pages || {})\n    if (pages.length === 0) {\n      return []\n    }\n    return res.query.pages[pages[0]].transcludedin || []\n  })\n}\nmodule.exports = getTransclusions\n","/* slow 1.1.0 MIT */\n//only do foo promises at a time.\nvar rateLimit = function rateLimit(arr, fn) {\n  var limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 5;\n  return new Promise(function (resolve, reject) {\n    //some validation\n    if (!arr || !fn) {\n      reject('Error: missing required parameters to rate-limit function');\n      return;\n    }\n\n    if (arr.length === 0) {\n      resolve([]);\n      return;\n    }\n\n    var results = [];\n    var n = limit - 1;\n    var pending = 0; //simple recursion, but with then/finally\n\n    var go = function go(i) {\n      pending += 1;\n      var p = fn(arr[i]);\n\n      if (!p.then) {\n        reject('Error: function must return a promise');\n        return;\n      }\n\n      p.then(function (r) {\n        results[i] = r;\n      });\n      p[\"catch\"](function (e) {\n        console.error(e);\n        results[i] = null;\n      });\n      p[\"finally\"](function () {\n        pending -= 1;\n        n += 1; //should we keep going?\n\n        if (arr.length >= n + 1) {\n          go(n);\n        } else if (pending <= 0) {\n          //no more to start - are we the last to finish?\n          resolve(results);\n        }\n      });\n    }; //fire-off first-n items\n\n\n    var init = arr.length < limit ? arr.length : limit;\n\n    for (var i = 0; i < init; i += 1) {\n      go(i);\n    }\n  });\n};\n\nvar rateLimit_1 = rateLimit;\n\nvar methods = {\n  one: function one(arr, fn) {\n    return rateLimit_1(arr, fn, 1);\n  },\n  two: function two(arr, fn) {\n    return rateLimit_1(arr, fn, 2);\n  },\n  three: function three(arr, fn) {\n    return rateLimit_1(arr, fn, 3);\n  },\n  four: function four(arr, fn) {\n    return rateLimit_1(arr, fn, 4);\n  },\n  five: function five(arr, fn) {\n    return rateLimit_1(arr, fn, 5);\n  },\n  ten: function ten(arr, fn) {\n    return rateLimit_1(arr, fn, 10);\n  },\n  fifteen: function fifteen(arr, fn) {\n    return rateLimit_1(arr, fn, 15);\n  }\n};\nmethods.serial = methods.one;\nmethods.linear = methods.one;\nmethods.crawl = methods.three;\nmethods.walk = methods.five;\nmethods.run = methods.ten;\nmethods.sprint = methods.fifteen;\nvar src = methods;\n\nexport default src;\n","const slow = require('slow')\n\nconst chunkBy = function (arr, chunkSize = 5) {\n  let groups = []\n  for (let i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchCat = function (cat, options = {}, wtf) {\n  if (!cat) {\n    return { docs: [], categories: [] }\n  }\n  return wtf.category(cat, options.lang).then((resp) => {\n    let pages = resp.pages.map((o) => o.title)\n    let groups = chunkBy(pages)\n\n    const doit = function (group) {\n      return wtf.fetch(group, options) //returns a promise\n    }\n    //only allow three requests at a time\n    return slow.three(groups, doit).then((responses) => {\n      //flatten the results\n      let docs = [].concat.apply([], responses)\n      return {\n        docs: docs,\n        categories: resp.categories\n      }\n    })\n  })\n}\n\nmodule.exports = fetchCat\n","const { defaults, toUrlParams } = require('./_fns')\n\nconst params = {\n  format: 'json',\n  action: 'query',\n  generator: 'random',\n  grnnamespace: 14,\n  prop: 'revisions',\n  grnlimit: 1,\n  origin: '*'\n}\n\nconst randomCategory = function (options = {}, http) {\n  options = Object.assign({}, defaults, options)\n  let url = `https://${options.lang}.wikipedia.org/${options.path}?`\n  if (options.domain) {\n    url = `https://${options.domain}/${options.path}?`\n  }\n  url += toUrlParams(params)\n  return http(url)\n    .then((res) => {\n      try {\n        let o = res.query.pages\n        let key = Object.keys(o)[0]\n        return o[key].title\n      } catch (e) {\n        throw e\n      }\n    })\n    .catch((e) => {\n      console.error(e)\n      return null\n    })\n}\nmodule.exports = randomCategory\n","const slow = require('slow')\nconst isObject = function (obj) {\n  return obj && Object.prototype.toString.call(obj) === '[object Object]'\n}\n\nconst chunkBy = function (arr, chunkSize = 5) {\n  let groups = []\n  for (let i = 0; i < arr.length; i += chunkSize) {\n    groups.push(arr.slice(i, i + chunkSize))\n  }\n  return groups\n}\n\nconst fetchList = function (pages, options, wtf) {\n  // support a list of strings, or objects\n  if (pages[0] && isObject(pages[0])) {\n    pages = pages.map((o) => o.title)\n  }\n  // fetch in groups of 5\n  let groups = chunkBy(pages)\n\n  const doit = function (group) {\n    return wtf.fetch(group, options) //returns a promise\n  }\n  //only allow three requests at a time\n  return slow.three(groups, doit).then((res) => {\n    // flatten into one list\n    return res.reduce((arr, a) => {\n      arr = arr.concat(a)\n      return arr\n    })\n  })\n}\nmodule.exports = fetchList\n","const getRedirects = require('./getRedirects')\nconst getIncoming = require('./getIncoming')\nconst getPageViews = require('./getPageViews')\nconst getTransclusions = require('./getTransclusions')\nconst getCategory = require('./getCategory')\nconst getRandomCategory = require('./getRandomCategory')\nconst fetchList = require('./fetchList')\n\nconst addMethod = function (models) {\n  // doc methods\n  models.Doc.prototype.getRedirects = function () {\n    return getRedirects(this, models.http)\n  }\n  models.Doc.prototype.getIncoming = function () {\n    return getIncoming(this, models.http)\n  }\n  models.Doc.prototype.getPageViews = function () {\n    return getPageViews(this, models.http)\n  }\n\n  // constructor methods\n  models.wtf.getRandomCategory = function (options) {\n    return getRandomCategory(options, models.http)\n  }\n  models.wtf.getTemplatePages = function (template, options) {\n    return getTransclusions(template, options, models.http)\n  }\n  models.wtf.getCategoryPages = function (category, options) {\n    return getCategory(category, options, models.wtf)\n  }\n  models.wtf.fetchList = function (list, options) {\n    return fetchList(list, options, models.wtf)\n  }\n}\nmodule.exports = addMethod\n"],"names":["title","replace","trim","encodeURIComponent","lang","path","obj","arr","Object","entries","map","key","value","join","normalize","defaults","toUrlParams","require$$0","params","action","rdnamespace","prop","rdlimit","format","origin","redirects","makeUrl","options","cursor","url","domain","getRedirects","doc","http","then","res","pages","keys","query","length","lhnamespace","lhshow","lhlimit","getIncoming","linkshere","getPageViews","pageviews","tinamespace","tilimit","getTransclusions","template","_options","transcludedin","rateLimit","fn","limit","arguments","undefined","Promise","resolve","reject","results","n","pending","go","i","p","r","e","console","error","init","rateLimit_1","methods","one","two","three","four","five","ten","fifteen","serial","linear","crawl","walk","run","sprint","src","chunkBy","chunkSize","groups","push","slice","fetchCat","cat","wtf","docs","categories","category","resp","o","doit","group","fetch","slow","responses","concat","apply","generator","grnnamespace","grnlimit","randomCategory","assign","catch","isObject","prototype","toString","call","fetchList","reduce","a","addMethod","models","Doc","getRandomCategory","getTemplatePages","getCategoryPages","getCategory","list"],"mappings":"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"}